# 第三方系统为机蜜引流，机蜜与第三方账号对接

---
##1.时序图
![时序图](https://file.zpmgo.com/api/download/temp/N2NiYzMyOTUtODNkMy00OGQ2LTliNzctYmIwNjVhN2U3ZWY2LnBuZw==)

##2.流程说明
 - 1.第三方系统添加“机蜜”入口，用户点击“机蜜”入口；
 - 2.跳转机蜜页面，进行机蜜业务流程，需要用户登录信息；
 - 3.机蜜获取第三方用户信息，跳转第三方授权页面；
 - 4.第三方系统判断用户是否在自身系统内注册登录，促使用户注册登录；
 - 5.第三方系统获取用户信息；
 - 6.第三方系统回调机蜜URL并将用户唯一标识“openId”传输给机蜜；
 - 7.机蜜根据用户openId向第三方系统查询用户详细信息；
 - 8.第三方系统返回用户手机号、身份证号、收货地址等详细信息；
 - 9.机蜜平台获取到用户信息，并使用户在机蜜平台静默登录。

##3.接口说明
###3.1.获取用户信息，跳转第三方授权页面
	第三方系统点击机蜜入口，跳转至机蜜页面并进行业务流程，当需要登录的用户的信息的时候，需要跳转第三方授权页面进行授权获取用户信息。
	打开第三方授权页面时，会将授权成功回调的机蜜URL作为参数添加在授权页面URL后。
	
 - 访问方式：get
 - 参数说明：

|名称|含义|类型|必填|备注|
|----|:---|:---|:--:|--------|
|from|机蜜回调URL|varchar(200)|Y|-|

 - 跳转示例：

```javascript
URL?from=xxx
```

 - 返回说明：

```javascript
成功授权，第三方跳转机蜜URL并传参数“success=true”、用户唯一标识“openId”；
取消授权，第三方跳转机蜜URL并传参数“success=false”。
```
|名称|含义|类型|备注|
|----|:---|:---|--------|
|openId|三方用户openId|varchar(50)|用户在第三方系统唯一标识|

###3.2.获取三方用户详细信息

 - 访问方式：post
 - 参数格式：application/json
 - 参数说明：

|名称|含义|类型|必填|备注|
|----|:---|:---|:--:|--------|
|openId|三方用户openId|varchar(50)|Y|-|


 - 参数示例：

```javascript
{
    "openId":"xxx"
}
```

 - 返回说明：

|名称|含义|类型|必填|备注|
|----|:---|:---|:--:|--------|
|openId|三方用户openId|varchar(50)|Y|用户在第三方系统唯一标识|
|phone|三方用户手机号|varchar(20)|Y|-|
|nickName|三方用户昵称|varchar(40)|N|-|
|cardId|三方用户身份证号码|varchar(20)|N|-|
|cardName|三方用户身份证姓名|varchar(50)|N|-|
|country|三方用户收货地址-国|varchar(20)|N|-|
|provice|三方用户收货地址-省|varchar(20)|N|-|
|city|三方用户收货地址-市|varchar(20)|N|-|
|regoin|三方用户收货地址-区县|varchar(20)|N|-|
|address|三方用户收货地址-详细地址|varchar(100)|N|-|








